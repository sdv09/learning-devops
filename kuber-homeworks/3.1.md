### Домашнее задание к занятию «Компоненты Kubernetes» [Степанников Денис]

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

### Решение

------
Для выполнения задания по расчету требований к кластеру под проект, выполните следующие шаги:

### 1. Расчет необходимых ресурсов для каждого компонента

- **База данных**:
  - Потребление: 4 ГБ ОЗУ, 1 ядро.
  - Количество копий: 3.
  - Общие ресурсы: 3 * 4 ГБ ОЗУ = 12 ГБ ОЗУ, 3 * 1 ядро = 3 ядра.

- **Кеш**:
  - Потребление: 4 ГБ ОЗУ, 1 ядро.
  - Количество копий: 3.
  - Общие ресурсы: 3 * 4 ГБ ОЗУ = 12 ГБ ОЗУ, 3 * 1 ядро = 3 ядра.

- **Фронтенд**:
  - Потребление: 50 МБ ОЗУ, 0.2 ядра.
  - Количество копий: 5.
  - Общие ресурсы: 5 * 50 МБ ОЗУ = 250 МБ ОЗУ, 5 * 0.2 ядра = 1 ядро.

- **Бекенд**:
  - Потребление: 600 МБ ОЗУ, 1 ядро.
  - Количество копий: 10.
  - Общие ресурсы: 10 * 600 МБ ОЗУ = 6 ГБ ОЗУ, 10 * 1 ядро = 10 ядер.

### 2. Подсчет суммарных ресурсов

- **Суммарное потребление ресурсов**:
  - Общий объем памяти (ОЗУ): 12 ГБ (БД) + 12 ГБ (Кеш) + 0.25 ГБ (Фронтенд) + 6 ГБ (Бекенд) = 30.25 ГБ ОЗУ.
  - Общее количество ядер: 3 ядра (БД) + 3 ядра (Кеш) + 1 ядро (Фронтенд) + 10 ядер (Бекенд) = 17 ядер.

### 3. Определение количества рабочих нод

- Для расчета количества нод, нужно выбрать типы машин, доступных в вашем облаке или инфраструктуре, с учетом доступных ресурсов на ноде (например, типичный экземпляр VM может иметь 4 ядра и 16 ГБ ОЗУ).
- Предположим, что выбранный тип ноды имеет 4 ядра и 16 ГБ ОЗУ:
  - Подсчитаем минимальное количество нод, которые смогут обслуживать указанную нагрузку.
  - Для нашей задачи:
    - Память: 30.25 ГБ / 16 ГБ = примерно 2 ноды.
    - Ядра: 17 ядер / 4 ядра = примерно 5 нод.

### 4. Добавление запаса на отказоустойчивость

- Добавим запас на случай выхода из строя одной ноды.
- Например, если расчет показал, что необходимо минимум 5 нод, увеличим их количество на 1-2 ноды для обеспечения высокой доступности.

### 5. Учет служебных ресурсов

- Также учтем, что на каждой ноде должны быть зарезервированы ресурсы для системных процессов Kubernetes (kubelet, контейнеров и т.д.).
- Обычно рекомендуется резервировать около 10-15% ресурсов ноды.

### 6. Итоговое количество нод и их параметры

- На основе вышеуказанных расчетов определяем финальное количество нод и их параметры.
- Если для минимальной работы требуется 5 нод, мы добавляем 2 ноды для отказоустойчивости, итого понадобиться 7 нод.

------